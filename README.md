# openblend
Modular media blending package for the Opentrons OT-2

## Installation

N/A

## Experimental workflow

1. Design experiment using Excel template
2. Run process_custom_design.py to generate deck setup
3. Setup the deck  
    A. The number of each tab corresponds to the numbered location on the 
       OT-2 deck  
    B. Volume requirements and reagent locations are in the file outputted
       by process_custom_design.py (..._reprocessed.xlsx)  
4. Upload the reprocessed Excel file to the /data/user_storage directory
   of the OT-2
5. Log into the OT-2, cd to /data/user_storage and run run_plate_prep.py

## Package contents

### experiment_designer.py

Contains the experiment_designer object which:
- checks that an experimental design does not exceed the maximum well volume
- checks that an experimental design does not require sub-uL volume additions
- generates stock solution setup with appropriate working volumes

### process_custom_design.py

Command line tool that generates deck setup instructions for stock solutions
from an input experimental design (see example_templates).

```bash
$> ls
my_design.xlsx
$> python process_custom_design.py my_design.xlsx
$> ls
my_design.xlsx
my_design_reprocessed.xlsx
$>  
```

### openblend_plates.py

Wrapper class that handles labware initialization.

### plate_builder.py

Contains the plate_builder object which executes liquid handling, adjusting
pipette movements to account for differences in working volume across labware.

### run_plate_prep.py

Command line tool that should be run from /data/user_storage using the OT-2's
command line interface. This tool initiates liquid blending using the
reprocessed spreadsheet containing stock solution setup information that
was generated by experiment_designer.py.

On the OT-2
```bash
$> pwd
/data/user_storage
$> python run_plate_prep.py my_design_reprocessed.xlsx
$>
```

### cal_protocol.py

This is a dummy protocol that can be uploaded to the Opentrons app, allowing
the user to proceed to tip calibration.

## SSH Access to Opentrons OT-2

See https://support.opentrons.com/en/articles/3287453-connecting-to-your-ot-2-with-ssh
to setup your ssh key.

Experiments can be uploaded to data storage using scp. Repositories cannot be
directly cloned to the OT-2, so it may be helpful to create powershell shortcuts.

Example: Microsoft.PowerShell_profile.ps1
```powershell
function login {ssh -i C:\Users\admin\ot2_ssh_key root@[Opentrons IP]}
function push {scp -i C:\Users\admin\ot2_ssh_key -r C:\Users\admin\Documents\Github\openblend\* root@[Opentrons IP]:/data/user_storage}
function pull {scp -i C:\USers\admin\ot2_ssh_key -r root@[XXX.XXX.XXX.XXX]:/data/user_storage/* C:\Users\admin\Documents\Github\openblend}
```

These powershell shortcut examples enable faster login into the OT-2 and push and pull
your personal repository branch to the /data/user_storage directory on the OT-2.

## Requirements
This package requires Opentrons software version >=3.16.1


